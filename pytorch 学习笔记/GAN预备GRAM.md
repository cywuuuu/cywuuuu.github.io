## GAN预备GRAM

n维欧式空间中任意k个向量之间两两的内积所组成的矩阵，称为这k个向量的格拉姆矩阵(Gram matrix)，很明显，这是一个对称矩阵。

![img](https://img2020.cnblogs.com/blog/1704791/202005/1704791-20200510091258297-1814861622.png)

更加直观的理解：

![img](https://img2020.cnblogs.com/blog/1704791/202005/1704791-20200510091258621-1096842037.png)



## 2.2 计算和特征表示

输入图像的feature map为[ ch, h, w]。我们经过flatten（即是将h*w进行平铺成一维向量）和矩阵转置操作，可以变形为[ ch, h*w]和[ h*w, ch]的矩阵。再对两个作内积得到Gram Matrices。 （蓝色条表示每个通道flatten后特征点，最后得到 [ch *ch ]的G矩阵）

![img](https://img2020.cnblogs.com/blog/1704791/202005/1704791-20200510091258930-186638669.png)

2.3 进一步理解

![img](https://img2020.cnblogs.com/blog/1704791/202005/1704791-20200510091259302-952646781.png)

格拉姆矩阵可以看做feature之间的偏心协方差矩阵（即没有减去均值的协方差矩阵），在feature map中，每个数字都来自于一个特定滤波器在特定位置的卷积，因此每个数字代表一个特征的强度，而Gram计算的实际上是两两特征之间的相关性，哪两个特征是同时出现的，哪两个是此消彼长的等等。

格拉姆矩阵用于度量各个维度自己的特性以及各个维度之间的关系。内积之后得到的多尺度矩阵中，对角线元素提供了不同特征图各自的信息，其余元素提供了不同特征图之间的相关信息。这样一个矩阵，既能体现出有哪些特征，又能体现出不同特征间的紧密程度。

### **关键点**：gram矩阵是计算每个通道 i 的feature map与每个通道 j 的feature map的内积。gram matrix的每个值可以说是代表 I 通道的feature map与 j 通道的feature map的互相关程度。

